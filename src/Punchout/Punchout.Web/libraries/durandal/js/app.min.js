define(["durandal/system","durandal/viewEngine","durandal/composition","durandal/events","jquery"],function(n,t,i,r,u){function s(){return n.defer(function(t){if(f.length==0){t.resolve();return}n.acquire(f).then(function(i){for(var e,u,r=0;r<i.length;r++)e=i[r],e.install?(u=o[r],n.isObject(u)||(u={}),e.install(u),n.log("Plugin:Installed "+f[r])):n.log("Plugin:Loaded "+f[r]);t.resolve()}).fail(function(t){n.error("Failed to load plugin(s). Details: "+t.message)})}).promise()}var e,f=[],o=[];return e={title:"Application",configurePlugins:function(t,i){var e=n.keys(t),r,u;for(i=i||"plugins/",i.indexOf("/",i.length-1)===-1&&(i+="/"),r=0;r<e.length;r++)u=e[r],f.push(i+u),o.push(t[u])},start:function(){return n.log("Application:Starting"),this.title&&(document.title=this.title),n.defer(function(t){u(function(){s().then(function(){t.resolve();n.log("Application:Started")})})}).promise()},setRoot:function(r,u,f){function s(){if(e.model)if(e.model.canActivate)try{var t=e.model.canActivate();t&&t.then?t.then(function(n){n&&i.compose(o,e)}).fail(function(t){n.error(t)}):t&&i.compose(o,e)}catch(r){n.error(r)}else i.compose(o,e);else i.compose(o,e)}var o,e={activate:!0,transition:u};o=!f||n.isString(f)?document.getElementById(f||"applicationHost"):f;n.isString(r)?t.isViewUrl(r)?e.view=r:e.model=r:e.model=r;n.isString(e.model)?n.acquire(e.model).then(function(t){e.model=n.resolveObject(t);s()}).fail(function(t){n.error("Failed to load root module ("+e.model+"). Details: "+t.message)}):s()}},r.includeIn(e),e})