define(["durandal/system","durandal/viewEngine"],function(n,t){function i(n,t){for(var r,u,i=0;i<n.length;i++)if(r=n[i],u=r.getAttribute("data-view"),u==t)return r}function r(n){return(n+"").replace(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g,"\\$1")}return{useConvention:function(n,t,i){n=n||"viewmodels";t=t||"views";i=i||t;var u=new RegExp(r(n),"gi");this.convertModuleIdToViewId=function(n){return n.replace(u,t)};this.translateViewIdToArea=function(n,t){return!t||t=="partial"?i+"/"+n:i+"/"+t+"/"+n}},locateViewForObject:function(t,i,r){var u,f;return t.getView&&(u=t.getView(),u)?this.locateView(u,i,r):t.viewUrl?this.locateView(t.viewUrl,i,r):(f=n.getModuleId(t),f)?this.locateView(this.convertModuleIdToViewId(f),i,r):this.locateView(this.determineFallbackViewId(t),i,r)},convertModuleIdToViewId:function(n){return n},determineFallbackViewId:function(n){var t=/function (.{1,})\(/.exec(n.constructor.toString()),i=t&&t.length>1?t[1]:"";return i=i.trim(),"views/"+i},translateViewIdToArea:function(n){return n},locateView:function(r,u,f){var e,o;return typeof r=="string"?(e=t.isViewUrl(r)?t.convertViewUrlToViewId(r):r,u&&(e=this.translateViewIdToArea(e,u)),f&&(o=i(f,e),o))?n.defer(function(n){n.resolve(o)}).promise():t.createView(e):n.defer(function(n){n.resolve(r)}).promise()}}})