define(["durandal/system"],function(n){return{typeAttribute:"type",space:undefined,replacer:function(n,t){if(n){var i=n[0];if(i==="_"||i==="$")return undefined}return t},serialize:function(t,i){return i=i===undefined?{}:i,(n.isString(i)||n.isNumber(i))&&(i={space:i}),JSON.stringify(t,i.replacer||this.replacer,i.space||this.space)},getTypeId:function(n){return n?n[this.typeAttribute]:undefined},typeMap:{},registerType:function(){var t=arguments[0],i;arguments.length==1?(i=t[this.typeAttribute]||n.getModuleId(t),this.typeMap[i]=t):this.typeMap[t]=arguments[1]},reviver:function(n,t,i,r){var f=i(t),u;return f&&(u=r(f),u)?u.fromJSON?u.fromJSON(t):new u(t):t},deserialize:function(n,t){var i=this;t=t||{};var r=t.getTypeId||function(n){return i.getTypeId(n)},u=t.getConstructor||function(n){return i.typeMap[n]},f=t.reviver||function(n,t){return i.reviver(n,t,r,u)};return JSON.parse(n,f)},clone:function(n,t){return this.deserialize(this.serialize(n,t),t)}}})