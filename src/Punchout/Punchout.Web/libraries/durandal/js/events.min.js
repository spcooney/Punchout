define(["durandal/system"],function(n){var r=/\s+/,t=function(){},i=function(n,t){this.owner=n;this.events=t};return i.prototype.then=function(n,t){if(this.callback=n||this.callback,this.context=t||this.context,!this.callback)return this;this.owner.on(this.events,this.callback,this.context);return this},i.prototype.on=i.prototype.then,i.prototype.off=function(){return this.owner.off(this.events,this.callback,this.context),this},t.prototype.on=function(n,t,u){var f,e,o;if(t){for(f=this.callbacks||(this.callbacks={}),n=n.split(r);e=n.shift();)o=f[e]||(f[e]=[]),o.push(t,u);return this}return new i(this,n)},t.prototype.off=function(t,i,u){var s,o,e,f;if(!(o=this.callbacks))return this;if(!(t||i||u))return delete this.callbacks,this;for(t=t?t.split(r):n.keys(o);s=t.shift();){if(!(e=o[s])||!(i||u)){delete o[s];continue}for(f=e.length-2;f>=0;f-=2)i&&e[f]!==i||u&&e[f+1]!==u||e.splice(f,2)}return this},t.prototype.trigger=function(n){var o,s,i,t,f,h,u,e;if(!(s=this.callbacks))return this;for(e=[],n=n.split(r),t=1,f=arguments.length;t<f;t++)e[t-1]=arguments[t];while(o=n.shift()){if((u=s.all)&&(u=u.slice()),(i=s[o])&&(i=i.slice()),i)for(t=0,f=i.length;t<f;t+=2)i[t].apply(i[t+1]||this,e);if(u)for(h=[o].concat(e),t=0,f=u.length;t<f;t+=2)u[t].apply(u[t+1]||this,h)}return this},t.prototype.proxy=function(n){var t=this;return function(i){t.trigger(n,i)}},t.includeIn=function(n){n.on=t.prototype.on;n.off=t.prototype.off;n.trigger=t.prototype.trigger;n.proxy=t.prototype.proxy},t})