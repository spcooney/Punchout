define(["durandal/system","jquery"],function(n,t){var i;return i=t.parseHTML?function(n){return t.parseHTML(n)}:function(n){return t(n).get()},{cache:{},viewExtension:".html",viewPlugin:"text",viewPluginParameters:"",isViewUrl:function(n){return n.indexOf(this.viewExtension,n.length-this.viewExtension.length)!==-1},convertViewUrlToViewId:function(n){return n.substring(0,n.length-this.viewExtension.length)},convertViewIdToRequirePath:function(n){var t=this.viewPlugin?this.viewPlugin+"!":"";return t+n+this.viewExtension+this.viewPluginParameters},parseMarkup:i,processMarkup:function(n){var t=this.parseMarkup(n);return this.ensureSingleElement(t)},ensureSingleElement:function(n){var i,u,r,f;if(n){if(n.length==1)return n[0]}else t("<div><\/div>")[0];for(i=[],u=0;u<n.length;u++)if(r=n[u],r.nodeType!=8){if(r.nodeType==3&&(f=/\S/.test(r.nodeValue),!f))continue;i.push(r)}return i.length>1?t(i).wrapAll('<div class="durandal-wrapper"><\/div>').parent().get(0):i[0]},tryGetViewFromCache:function(n){return this.cache[n]},putViewInCache:function(n,t){this.cache[n]=t},createView:function(t){var r=this,i=this.convertViewIdToRequirePath(t),u=this.tryGetViewFromCache(i);return u?n.defer(function(n){n.resolve(u.cloneNode(!0))}).promise():n.defer(function(u){n.acquire(i).then(function(n){var f=r.processMarkup(n);f.setAttribute("data-view",t);r.putViewInCache(i,f);u.resolve(f.cloneNode(!0))}).fail(function(n){r.createFallbackView(t,i,n).then(function(n){n.setAttribute("data-view",t);r.cache[i]=n;u.resolve(n.cloneNode(!0))})})}).promise()},createFallbackView:function(t,i){var r=this,u='View Not Found. Searched for "'+t+'" via path "'+i+'".';return n.defer(function(n){n.resolve(r.processMarkup('<div class="durandal-view-404">'+u+"<\/div>"))}).promise()}}})