define(["durandal/system","durandal/composition","jquery"],function(n,t,i){function f(n,t){n.classList.remove(t?"entrance-in-fade":"entrance-in");n.classList.remove("entrance-out")}var e=100,l={left:"0px",opacity:1},o={left:"",top:"",right:"",bottom:"",position:"",opacity:""},s=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/MSIE/),r=!1,h="Webkit Moz O ms Khtml".split(" "),c=document.createElement("div"),u;if(c.style.animationName!==undefined&&(r=!0),!r)for(u=0;u<h.length;u++)if(c.style[h[u]+"AnimationName"]!==undefined){r=!0;break}return r?s?n.log("Using CSS3/jQuery mixed animations."):n.log("Using CSS3 animations."):n.log("Using jQuery animations."),function(t){return n.defer(function(n){function c(){n.resolve()}function y(){t.keepScrollPosition||i(document).scrollTop(0)}if(t.child){var v=t.duration||500,h=i(t.child),u=!!t.fadeOnly,p={display:"block",opacity:0,position:"absolute",left:u||r?"0px":"20px",right:0,top:0,bottom:0};function a(){y();t.triggerAttach();r?(f(t.child,u),t.child.classList.add(u?"entrance-in-fade":"entrance-in"),setTimeout(function(){f(t.child,u);t.activeView&&f(t.activeView,u);h.css(o);c()},v)):h.animate(l,{duration:v,easing:"swing",always:function(){h.css(o);c()}})}h.css(p);t.activeView?r&&!s?(f(t.activeView,u),t.activeView.classList.add("entrance-out"),setTimeout(a,e)):i(t.activeView).fadeOut({duration:e,always:a}):a()}else i(t.activeView).fadeOut(e,c)}).promise()}})